# 08. 스케줄링 : 멀티 레벨 피드백 큐


## 멀티 레벨 피드백 큐 (MLFQ) 해결하고바 하는 문제
(1) 짧은 작업을 먼저 실행시켜 반환 시간을 최적화


SJF 나 STCF 같은 알고리즘은 작업의 실행 시간 정보를 필요하다.


-> 그러나, 운영체제는 이 실행 시간을 미리 알 수 없다. 


(2) 응답 시간 최적화


대화형 사용자(즉, 화면 앞에 앉아 바라보면서 프로세스의 종료를 기다리는 사용자)에게 응답이 빠른 시스템이라는 느낌을 주고 싶기 때문에 응답 시간을 최적화한다. 


-> RR과 같은 알고리즘은 응답 시간을 단축시키지만 반환 시간은 거의 최악이다. 




-> 정보 없이 스케줄 하는 방법은 무엇인가?


<br>

## 1.  기본 규칙
MLFQ는 여러 개의 큐로 구성되며, 각각 작업 특성에 따라 다른 우선 순위가 배정된다.


• 규칙 1: Priority(A) > Priority(B) 이면, A가 실행된다 (B는 실행되지 않는다).


• 규칙 2: Priority(A) = Priority(B) 이면, A와 B는 RR 방식으로 실행된다.


-> 그러나 A와 B보다 낮은 우선 순위를 가진 작업들은 실행되지 않는다.

<br>

## 2. 우선순위 변경

<img width="240" alt="스크린샷 2025-04-08 오후 12 52 03" src="https://github.com/user-attachments/assets/d17888fc-9163-4e68-a6a7-4145e8f0930e" />
사진 출처 : 운영체제 아주 쉬운 세가지 이야기

•규칙3: 작업이 시스템에 진입하면, 가장 높은 우선순위,즉 맨 위의 큐에 놓여진다.


• 규칙 4a: 주어진 타임 슬라이스를 모두 사용하면 우선순위는 낮아진다. 즉, 한 단계 아래 큐로 이동한다.


• 규칙 4b: 타임 슬라이스를 소진하기 전에 CPU를 양도하면 같은 우선순위를 유지한다.


<br>

## 3. 현재 MLFQ의 문제점

CPU를 긴 작업들과 짧은 작업들 사이에 잘 공유하고, 입출력-중점 대화형 작업을 빨리 실행시키기 때문에 잘 동작하는 것처럼 보인다. 


(1) 기아상태


시스템에 너무 많은 대화형 작업이 존재하면 모든 CPU 시간을 소모하게 되기 때문에 긴 실행시간작업은 CPU 시간을 할당받지 못할 것이다.


(2) 우선순위 조작


(3) 프로그램 특성 변경될 경우


CPU위주 작업이 대화형 작업으로 바뀌는 경우에는 대화형 작업들과 같은 대우를 받을 수 없다.


<br>

## 4. 우선순위의 상향 조정


•규칙5: 일정 기간 S가 지나면, 시스템의 모든 작업을 최상위 큐로 이동시킨다.


-> 두 가지 문제점 모두 해결


(1) 기아 문제


최상위 큐에 존재하는 동안 RR 방식으로 CPU를 공유하게 되기 때문이다.


(2) 프로그램 특성 변경될 경우


우선순위 상향을 통해 스케줄러가 변경된 특성에 적합한 스케줄링 방법을 적용하기 때문이다.



## 5. 더 나은 시간 측정


마지막 남은 문제는 스케줄러 우선순위를 조작하는 것이다.


-> MLFQ의 각 단계에서 CPU 총 사용 시간을 측정하는 것이다.


스케줄러는 현재 단계에서 프로세스가 소진한 CPU 사용 시간을 저장한다.




규칙 4a와 4b를 합쳐서

규칙 4: 주어진 단계에서 시간 할당량을 소진하면 (CPU를 몇 번 양도하였는지 상관없이), 우선순위는 낮아진다 

(즉, 아래 단계의 큐로 이동한다)

